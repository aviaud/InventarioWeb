<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Inventario - Google Sheets API</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Inventario</h1>
  </header>

  <main>
    <section id="form-section">
      <h2>Agregar producto</h2>
      <form id="product-form">
        <input name="Codigo" placeholder="Código" required>
        <input name="Nombre" placeholder="Nombre" required>
        <input name="Stock" type="number" placeholder="Stock" required>
        <input name="Precio" type="number" step="0.01" placeholder="Precio" required>
        <input name="Descripcion" placeholder="Descripción">
        <button type="submit">Guardar</button>
      </form>
    </section>

    <section id="list-section">
      <h2>Lista</h2>
      <table id="table-inventory">
        <thead></thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <template id="row-template">
    <tr>
      <td class="row-index"></td>
      <td class="col-Codigo"></td>
      <td class="col-Nombre"></td>
      <td class="col-Stock"></td>
      <td class="col-Precio"></td>
      <td class="col-Descripcion"></td>
      <td>
        <button class="edit">Editar</button>
        <button class="delete">Eliminar</button>
      </td>
    </tr>
  </template>

  <script>
  // ----- CONFIG -----
  const API_URL = 'https://script.google.com/macros/s/AKfycbx8iRDLz0XHZnWugBgJg8WWxrLpc-bUxzVcwxL4JTVs_TJAU9TrEx87u31FlJ3-TXlD/exec'; // <- cambia esto
  const SHEET_HEADERS = ['ID','Codigo','Nombre','Stock','Precio','Descripcion'];
  // ------------------

  const tableHead = document.querySelector('#table-inventory thead');
  const tableBody = document.querySelector('#table-inventory tbody');
  const form = document.getElementById('product-form');
  const rowTpl = document.getElementById('row-template');

  function buildHead() {
    const tr = document.createElement('tr');
    ['#', ...SHEET_HEADERS.slice(1), 'Acciones'].forEach(h => {
      const th = document.createElement('th'); th.textContent = h; tr.appendChild(th);
    });
    tableHead.innerHTML = ''; tableHead.appendChild(tr);
  }

  async function fetchList() {
    const res = await fetch(API_URL);
    const data = await res.json();
    // data es un array de objetos donde keys son encabezados
    renderTable(data);
  }

  function renderTable(data) {
    tableBody.innerHTML = '';
    data.forEach((rowObj, idx) => {
      const clone = rowTpl.content.cloneNode(true);
      clone.querySelector('.row-index').textContent = idx + 2; // fila en hoja (asumiendo encabezado)
      SHEET_HEADERS.forEach(h => {
        const cell = clone.querySelector('.col-' + h);
        if (cell) cell.textContent = rowObj[h] || '';
      });
      const tr = clone.querySelector('tr');
      // botones
      tr.querySelector('.edit').addEventListener('click', () => fillFormForEdit(idx + 2, rowObj));
      tr.querySelector('.delete').addEventListener('click', () => deleteRow(idx + 2));
      tableBody.appendChild(tr);
    });
  }

  function fillFormForEdit(rowIndex, data) {
    form.dataset.editing = rowIndex; // guardamos indice de fila
    for (const k of ['Codigo','Nombre','Stock','Precio','Descripcion']) {
      form.elements[k].value = data[k] || '';
    }
    form.querySelector('button').textContent = 'Actualizar';
  }

  form.addEventListener('submit', async (ev) => {
    ev.preventDefault();
    const fd = new FormData(form);
    const payload = {};
    for (const [k,v] of fd.entries()) payload[k] = v;

    if (form.dataset.editing) {
      payload.action = 'update';
      payload.rowIndex = form.dataset.editing;
    } else {
      payload.action = 'create';
    }

    await postJSON(API_URL, payload);
    form.reset(); delete form.dataset.editing;
    form.querySelector('button').textContent = 'Guardar';
    fetchList();
  });

  async function deleteRow(rowIndex) {
    if (!confirm('Eliminar fila ' + rowIndex + '?')) return;
    await postJSON(API_URL, { action: 'delete', rowIndex });
    fetchList();
  }

  async function postJSON(url, obj) {
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(obj)
    });
    return await res.json();
  }

  buildHead(); fetchList();
  </script>
</body>
</html>

